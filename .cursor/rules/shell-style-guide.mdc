---
globs: *.sh
description: Bash Shell Style Guide for executables and libraries in this repo
---

{
  "language": "shell",
  "rules": {
    "shell": {
      "which_shell_to_use": "bash only (#/bin/bash), no POSIX portability unless forced",
      "file_extensions": "executables: .sh or none; libraries: .sh, non-executable",
      "suid_sgid": "forbidden, use sudo instead",
      "stdout_stderr": "errors must go to STDERR",
      "comments": {
        "file_header": "each file must start with overview comment",
        "function_comments": "describe Description, Globals, Args, Outputs, Returns",
        "implementation_comments": "only for tricky parts",
        "todo": "TODO(name): ... format"
      },
      "formatting": {
        "indentation": "2 spaces, no tabs",
        "line_length": "80 chars max, break with here-doc or newline",
        "pipelines": "if long, split per line with \\",
        "control_flow": "; then and ; do on same line, else on new line",
        "case": "indent 2 spaces, ;; aligned, no ;& or ;;&",
        "variable_expansion": "quote variables, prefer ${var}, consistent style",
        "quoting": "always quote expansions, prefer \"$@\" over $*"
      },
      "features": {
        "shellcheck": "must run ShellCheck",
        "command_substitution": "use $(command), never backticks",
        "test": "prefer [[ ]] over [ ]",
        "string_tests": "use -z/-n, not filler chars",
        "wildcard": "always use ./*, never *",
        "eval": "forbidden",
        "arrays": "use arrays for lists and args, expand with \"${arr[@]}\"",
        "pipes_to_while": "avoid, use process substitution or readarray",
        "arithmetic": "use (( )) or $(( )), never let/expr/$[]",
        "aliases": "forbidden, use functions"
      },
      "naming": {
        "functions": "lower_case_with_underscores or package::func",
        "variables": "lower_case_with_underscores",
        "constants": "UPPER_CASE, declared readonly",
        "filenames": "lowercase_with_optional_underscores",
        "locals": "declare locals in functions, assignment separate from command substitution",
        "function_location": "all functions grouped under constants",
        "main": "scripts with funcs must have main() at bottom, last line main \"$@\""
      },
      "calling_commands": {
        "check_returns": "always check return values with if or PIPESTATUS",
        "builtin_vs_external": "prefer builtins over external (expr, sed, etc.)"
      },
      "consistency": "when in doubt, be consistent"
    }
  }
}